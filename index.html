<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All-in-One Smart Trading Journal + Live Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a237e;
            --primary-light: #534bae;
            --primary-dark: #000051;
            --secondary: #00b0ff;
            --success: #4caf50;
            --danger: #f44336;
            --warning: #ff9800;
            --light: #f5f5f5;
            --dark: #212121;
            --gray: #9e9e9e;
            --gray-light: #e0e0e0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px 0;
            transition: all 0.3s;
        }
        
        .logo {
            text-align: center;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .logo h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .logo p {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .nav-links {
            list-style: none;
            padding: 20px 0;
        }
        
        .nav-links li {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-links li:hover, .nav-links li.active {
            background-color: rgba(255,255,255,0.1);
            border-left: 4px solid var(--secondary);
        }
        
        .nav-links i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .header h1 {
            color: var(--primary);
            font-size: 1.8rem;
        }
        
        .header-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .creator-credit {
            font-size: 0.9rem;
            color: var(--gray);
            font-style: italic;
        }
        
        .date-filter {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .date-filter select, .date-filter input {
            padding: 8px 12px;
            border: 1px solid var(--gray-light);
            border-radius: 4px;
            background-color: white;
        }
        
        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            border-radius: 6px;
            background-color: var(--light);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .profit {
            color: var(--success);
        }
        
        .loss {
            color: var(--danger);
        }
        
        /* Account Balance */
        .balance-card {
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            color: white;
            grid-column: 1 / -1;
        }
        
        .balance-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .balance-item {
            text-align: center;
        }
        
        .balance-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .balance-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .market-sessions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .session {
            text-align: center;
            padding: 10px;
            border-radius: 6px;
            background-color: rgba(255,255,255,0.1);
            flex: 1;
            margin: 0 5px;
        }
        
        .session.active {
            background-color: rgba(255,255,255,0.2);
            border: 1px solid var(--secondary);
        }
        
        /* Charts */
        .charts-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            height: 300px;
        }
        
        .chart-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        /* Trading Journal */
        .journal-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .journal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .journal-controls {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }
        
        th {
            background-color: var(--light);
            color: var(--primary);
            font-weight: 600;
        }
        
        tr:hover {
            background-color: rgba(0,0,0,0.02);
        }
        
        .status-win {
            color: var(--success);
            font-weight: bold;
        }
        
        .status-loss {
            color: var(--danger);
            font-weight: bold;
        }
        
        .status-breakeven {
            color: var(--warning);
            font-weight: bold;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 800px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            color: var(--primary);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--gray-light);
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .chart-upload {
            border: 2px dashed var(--gray-light);
            padding: 20px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .chart-upload:hover {
            border-color: var(--primary);
            background-color: rgba(26, 35, 126, 0.05);
        }
        
        .chart-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            display: none;
        }
        
        /* Settings Page */
        .settings-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .settings-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .settings-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        /* Analytics Page */
        .analytics-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .analytics-chart {
            height: 300px;
        }
        
        /* Page Sections */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* Account Selector */
        .account-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .account-selector select {
            padding: 8px 12px;
            border: 1px solid var(--gray-light);
            border-radius: 4px;
            background-color: white;
            min-width: 200px;
        }
        
        .account-selector .btn {
            padding: 8px 12px;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .nav-links {
                display: flex;
                overflow-x: auto;
            }
            
            .nav-links li {
                flex-shrink: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .header-info {
                width: 100%;
                justify-content: space-between;
            }
        }
        
        .editable {
            cursor: pointer;
            border-bottom: 1px dashed var(--gray);
            padding: 2px 4px;
        }
        
        .editable:hover {
            background-color: rgba(0,0,0,0.05);
        }
        
        /* Calendar Styles */
        .calendar-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .calendar-nav button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: var(--gray-light);
            border: 1px solid var(--gray-light);
        }
        
        .calendar-day-header {
            background-color: var(--light);
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
        }
        
        .calendar-day {
            background-color: white;
            padding: 8px;
            min-height: 100px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .calendar-day:hover {
            background-color: rgba(0,0,0,0.02);
        }
        
        .calendar-day.empty {
            background-color: #f9f9f9;
            cursor: default;
        }
        
        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .day-pnl {
            font-size: 0.8rem;
            margin-bottom: 3px;
        }
        
        .day-trades {
            font-size: 0.7rem;
            color: var(--gray);
        }
        
        .calendar-summary {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--gray-light);
        }
        
        .monthly-summary {
            display: flex;
            gap: 20px;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .summary-label {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Dashboard Layout */
        .dashboard-top {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .dashboard-balance {
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .balance-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .balance-section {
            text-align: center;
        }
        
        .balance-title {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .balance-amount {
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .market-status {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .market-session {
            text-align: center;
            padding: 10px;
            border-radius: 6px;
            background-color: rgba(255,255,255,0.1);
        }
        
        .market-session.active {
            background-color: rgba(255,255,255,0.2);
            border: 1px solid var(--secondary);
        }
        
        .session-time {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .session-name {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        /* Responsive Calendar */
        @media (max-width: 768px) {
            .calendar-day {
                min-height: 70px;
                padding: 5px;
            }
            
            .day-pnl, .day-trades {
                font-size: 0.7rem;
            }
            
            .dashboard-top {
                grid-template-columns: 1fr;
            }
        }
        
        .today {
            background-color: rgba(0, 176, 255, 0.1);
            border: 1px solid var(--secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h1>Smart Trading Journal</h1>
                <p>Dashboard & Analytics</p>
            </div>
            <ul class="nav-links">
                <li class="active" data-page="dashboard"><i class="fas fa-chart-line"></i> Dashboard</li>
                <li data-page="journal"><i class="fas fa-book"></i> Trading Journal</li>
                <li data-page="analytics"><i class="fas fa-chart-bar"></i> Analytics</li>
                <li data-page="settings"><i class="fas fa-cog"></i> Settings</li>
            </ul>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page active">
                <div class="header">
                    <h1>Dashboard</h1>
                    <div class="header-info">
                        <div class="date-filter">
                            <select id="month-select">
                                <option value="0">January</option>
                                <option value="1">February</option>
                                <option value="2">March</option>
                                <option value="3">April</option>
                                <option value="4">May</option>
                                <option value="5">June</option>
                                <option value="6">July</option>
                                <option value="7">August</option>
                                <option value="8">September</option>
                                <option value="9">October</option>
                                <option value="10">November</option>
                                <option value="11">December</option>
                            </select>
                            <input type="number" id="year-input" min="2000" max="2030">
                        </div>
                        <div class="creator-credit">
                            Created by Zeradam Yitbarek
                        </div>
                    </div>
                </div>
                
                <!-- Account Selector -->
                <div class="account-selector">
                    <select id="account-select">
                        <option value="1">Main Trading Account</option>
                        <option value="2">Forex Account</option>
                        <option value="3">Crypto Account</option>
                    </select>
                    <button class="btn btn-primary" id="add-account-btn">Add Account</button>
                    <button class="btn btn-danger" id="delete-account-btn">Delete Account</button>
                </div>
                
                <!-- Dashboard Top Section with Balance and Market Sessions -->
                <div class="dashboard-top">
                    <div class="dashboard-balance">
                        <div class="balance-display">
                            <div class="balance-section">
                                <div class="balance-title">Starting Balance</div>
                                <div class="balance-amount editable" id="starting-balance">$54,386.30</div>
                            </div>
                            <div class="balance-section">
                                <div class="balance-title">Actual Balance</div>
                                <div class="balance-amount" id="actual-balance">$58,947.50</div>
                            </div>
                        </div>
                        <div class="market-status">
                            <div class="market-session">
                                <div class="session-time">22:53</div>
                                <div class="session-name">Sydney</div>
                            </div>
                            <div class="market-session">
                                <div class="session-time">20:33</div>
                                <div class="session-name">Tokyo</div>
                            </div>
                            <div class="market-session active">
                                <div class="session-time">11:53</div>
                                <div class="session-name">London</div>
                            </div>
                            <div class="market-session">
                                <div class="session-time">6:53</div>
                                <div class="session-name">New York</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PnL Card -->
                    <div class="card">
                        <h3>Profit & Loss</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-label">PnL</div>
                                <div class="stat-value profit" id="total-pnl">+$4,561.20</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Deposits</div>
                                <div class="stat-value" id="total-deposits">$1,989.25</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Withdrawals</div>
                                <div class="stat-value" id="total-withdrawals">$0.00</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Fees + Commissions</div>
                                <div class="stat-value loss" id="total-fees">-$31.75</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Calendar Section -->
                <div class="calendar-container">
                    <div class="calendar-header">
                        <h3 id="calendar-month-year">Loading...</h3>
                        <div class="calendar-nav">
                            <button id="prev-month"><i class="fas fa-chevron-left"></i></button>
                            <button id="next-month"><i class="fas fa-chevron-right"></i></button>
                        </div>
                    </div>
                    <div class="calendar-grid" id="calendar-grid">
                        <!-- Calendar will be populated by JavaScript -->
                    </div>
                    <div class="calendar-summary">
                        <div class="monthly-summary">
                            <div class="summary-item">
                                <div class="summary-value profit" id="monthly-profit">$0.00</div>
                                <div class="summary-label">Monthly Profit</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="monthly-trades">0</div>
                                <div class="summary-label">Total Trades</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-value" id="monthly-win-rate">0%</div>
                                <div class="summary-label">Win Rate</div>
                            </div>
                        </div>
                        <div>
                            <button class="btn btn-primary" id="view-trades-btn">View All Trades</button>
                        </div>
                    </div>
                </div>
                
                <!-- Dashboard Cards -->
                <div class="dashboard-cards">
                    <!-- Trading Stats Card -->
                    <div class="card">
                        <h3>My Stats</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-label">Total Trades</div>
                                <div class="stat-value" id="total-trades">20</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Win Rate</div>
                                <div class="stat-value" id="win-rate">65.00%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Profit Factor</div>
                                <div class="stat-value" id="profit-factor">1.49</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Expectancy</div>
                                <div class="stat-value" id="expectancy">$92.63</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Risk Management Card -->
                    <div class="card">
                        <h3>Risk Management</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-label">Absolute DD</div>
                                <div class="stat-value loss" id="absolute-dd">-0.25%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Max DD</div>
                                <div class="stat-value loss" id="max-dd">-0.54%</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Avg Win</div>
                                <div class="stat-value profit" id="avg-win">$292.50</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Avg Loss</div>
                                <div class="stat-value loss" id="avg-loss">-$264.00</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Charts Section -->
                <div class="charts-container">
                    <div class="chart-card">
                        <h3>Growth Over Time</h3>
                        <canvas id="growthChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Win/Loss Distribution</h3>
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Trading Journal Page -->
            <div id="journal-page" class="page">
                <div class="header">
                    <h1>Trading Journal</h1>
                    <div class="header-info">
                        <div class="date-filter">
                            <select id="journal-month">
                                <option value="0">January</option>
                                <option value="1">February</option>
                                <option value="2">March</option>
                                <option value="3">April</option>
                                <option value="4">May</option>
                                <option value="5">June</option>
                                <option value="6">July</option>
                                <option value="7">August</option>
                                <option value="8">September</option>
                                <option value="9">October</option>
                                <option value="10">November</option>
                                <option value="11">December</option>
                            </select>
                            <input type="number" id="journal-year" min="2000" max="2030">
                        </div>
                        <div class="creator-credit">
                            Created by Zeradam Yitbarek
                        </div>
                    </div>
                </div>
                
                <!-- Account Selector -->
                <div class="account-selector">
                    <select id="journal-account-select">
                        <option value="1">Main Trading Account</option>
                        <option value="2">Forex Account</option>
                        <option value="3">Crypto Account</option>
                    </select>
                </div>
                
                <div class="journal-container">
                    <div class="journal-header">
                        <h3>Trade History</h3>
                        <div class="journal-controls">
                            <button class="btn btn-primary" id="add-trade-btn">Add Trade</button>
                            <button class="btn btn-success" id="export-data">Export Data</button>
                            <button class="btn btn-danger" id="import-data">Import Data</button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Date</th>
                                <th>Result</th>
                                <th>Market</th>
                                <th>Pair</th>
                                <th>Size</th>
                                <th>P&L</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="trade-table-body">
                            <!-- Trade rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Analytics Page -->
            <div id="analytics-page" class="page">
                <div class="header">
                    <h1>Analytics</h1>
                    <div class="header-info">
                        <div class="date-filter">
                            <select id="analytics-month">
                                <option value="0">January</option>
                                <option value="1">February</option>
                                <option value="2">March</option>
                                <option value="3">April</option>
                                <option value="4">May</option>
                                <option value="5">June</option>
                                <option value="6">July</option>
                                <option value="7">August</option>
                                <option value="8">September</option>
                                <option value="9">October</option>
                                <option value="10">November</option>
                                <option value="11">December</option>
                            </select>
                            <input type="number" id="analytics-year" min="2000" max="2030">
                        </div>
                        <div class="creator-credit">
                            Created by Zeradam Yitbarek
                        </div>
                    </div>
                </div>
                
                <!-- Account Selector -->
                <div class="account-selector">
                    <select id="analytics-account-select">
                        <option value="1">Main Trading Account</option>
                        <option value="2">Forex Account</option>
                        <option value="3">Crypto Account</option>
                    </select>
                </div>
                
                <div class="analytics-container">
                    <h3>Performance Analytics</h3>
                    <div class="analytics-grid">
                        <div class="chart-card analytics-chart">
                            <h4>Performance by Market</h4>
                            <canvas id="marketChart"></canvas>
                        </div>
                        <div class="chart-card analytics-chart">
                            <h4>Win Rate by Market</h4>
                            <canvas id="winRateChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Page -->
            <div id="settings-page" class="page">
                <div class="header">
                    <h1>Settings</h1>
                    <div class="header-info">
                        <div class="date-filter">
                            <!-- Empty date filter for alignment -->
                        </div>
                        <div class="creator-credit">
                            Created by Zeradam Yitbarek
                        </div>
                    </div>
                </div>
                
                <div class="settings-container">
                    <div class="settings-section">
                        <h3>Data Management</h3>
                        <div class="form-group">
                            <p>Your data is automatically saved in your browser. Use these options to backup or restore your data.</p>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-success" id="backup-data">Backup All Data</button>
                            <button class="btn btn-primary" id="restore-data">Restore from Backup</button>
                            <button class="btn btn-danger" id="clear-data">Clear All Data</button>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Account Settings</h3>
                        <div class="form-group">
                            <label for="account-name">Account Name</label>
                            <input type="text" id="account-name" class="form-control" value="Main Trading Account">
                        </div>
                        <div class="form-group">
                            <label for="account-currency">Account Currency</label>
                            <select id="account-currency" class="form-control">
                                <option value="USD" selected>USD</option>
                                <option value="EUR">EUR</option>
                                <option value="GBP">GBP</option>
                                <option value="JPY">JPY</option>
                                <option value="AUD">AUD</option>
                                <option value="CAD">CAD</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="risk-per-trade">Risk Per Trade (%)</label>
                            <input type="number" id="risk-per-trade" class="form-control" value="1" min="0.1" max="10" step="0.1">
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Trade Settings</h3>
                        <div class="form-group">
                            <label for="default-lot-size">Default Lot Size</label>
                            <input type="number" id="default-lot-size" class="form-control" value="0.1" min="0.01" step="0.01">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" id="save-settings">Save Settings</button>
                        <button class="btn btn-danger" id="reset-settings">Reset to Default</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Trade Modal -->
    <div class="modal" id="trade-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Add New Trade</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="trade-form">
                    <input type="hidden" id="trade-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="trade-date">Date</label>
                            <input type="date" id="trade-date" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="trade-time">Time</label>
                            <input type="time" id="trade-time" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="trade-market">Market</label>
                            <select id="trade-market" class="form-control" required>
                                <option value="">Select Market</option>
                                <option value="Forex">Forex</option>
                                <option value="Crypto">Crypto</option>
                                <option value="Stocks">Stocks</option>
                                <option value="Indices">Indices</option>
                                <option value="Commodities">Commodities</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="trade-pair">Pair/Instrument</label>
                            <select id="trade-pair" class="form-control" required>
                                <option value="">Select Pair</option>
                                <!-- Options will be populated based on market selection -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="trade-direction">Direction</label>
                            <select id="trade-direction" class="form-control" required>
                                <option value="Long">Long</option>
                                <option value="Short">Short</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="trade-size">Size</label>
                            <input type="number" id="trade-size" class="form-control" step="0.01" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="trade-result">Result</label>
                            <select id="trade-result" class="form-control" required>
                                <option value="WIN">Win</option>
                                <option value="LOSS">Loss</option>
                                <option value="B/E">Break Even</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="trade-pnl">P&L ($)</label>
                            <input type="number" id="trade-pnl" class="form-control" step="0.01" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="trade-notes">Notes</label>
                        <textarea id="trade-notes" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Chart Image (Optional)</label>
                        <div class="chart-upload" id="chart-upload-area">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>Click to upload chart image</p>
                            <input type="file" id="chart-image" accept="image/*" style="display: none;">
                            <img id="chart-preview" class="chart-preview">
                        </div>
                    </div>
                    
                    <div class="form-row" style="justify-content: flex-end; margin-top: 20px;">
                        <button type="button" class="btn btn-danger" id="cancel-trade">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Trade</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Account Modal -->
    <div class="modal" id="account-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Account</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="account-form">
                    <div class="form-group">
                        <label for="new-account-name">Account Name</label>
                        <input type="text" id="new-account-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="new-account-currency">Account Currency</label>
                        <select id="new-account-currency" class="form-control" required>
                            <option value="USD" selected>USD</option>
                            <option value="EUR">EUR</option>
                            <option value="GBP">GBP</option>
                            <option value="JPY">JPY</option>
                            <option value="AUD">AUD</option>
                            <option value="CAD">CAD</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="new-account-balance">Starting Balance</label>
                        <input type="number" id="new-account-balance" class="form-control" step="0.01" required>
                    </div>
                    
                    <div class="form-row" style="justify-content: flex-end; margin-top: 20px;">
                        <button type="button" class="btn btn-danger" id="cancel-account">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Account</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Import Data Modal -->
    <div class="modal" id="import-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Data</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <p>Select a backup file to restore your data. This will replace all current data.</p>
                    <input type="file" id="import-file" accept=".json" class="form-control">
                </div>
                <div class="form-row" style="justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-danger" id="cancel-import">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirm-import">Import Data</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage keys
        const STORAGE_KEYS = {
            TRADES: 'tradingJournal_trades',
            ACCOUNTS: 'tradingJournal_accounts',
            SETTINGS: 'tradingJournal_settings'
        };

        // Get current date from computer
        const currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();

        // Load data from localStorage or use defaults
        function loadData() {
            // Load trades
            const savedTrades = localStorage.getItem(STORAGE_KEYS.TRADES);
            let trades = savedTrades ? JSON.parse(savedTrades) : getDefaultTrades();
            
            // Load accounts
            const savedAccounts = localStorage.getItem(STORAGE_KEYS.ACCOUNTS);
            let accounts = savedAccounts ? JSON.parse(savedAccounts) : getDefaultAccounts();
            
            return { trades, accounts };
        }

        // Save data to localStorage
        function saveData(trades, accounts) {
            localStorage.setItem(STORAGE_KEYS.TRADES, JSON.stringify(trades));
            localStorage.setItem(STORAGE_KEYS.ACCOUNTS, JSON.stringify(accounts));
        }

        // Get default trades data
        function getDefaultTrades() {
            return [
                // Current month trades
                { id: 1, accountId: 1, date: `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-01`, time: "12:08", result: "WIN", market: "Forex", pair: "EURUSD", size: 2.5, pnl: 71.32, notes: "", chartImage: null },
                { id: 2, accountId: 1, date: `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-03`, time: "10:15", result: "WIN", market: "Forex", pair: "GBPUSD", size: 1.22, pnl: 19.22, notes: "", chartImage: null },
                { id: 3, accountId: 1, date: `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-04`, time: "14:30", result: "WIN", market: "Forex", pair: "USDJPY", size: 1.76, pnl: 80.35, notes: "", chartImage: null },
                { id: 4, accountId: 1, date: `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-06`, time: "09:45", result: "WIN", market: "Indices", pair: "US100", size: 3, pnl: 682.10, notes: "", chartImage: null },
                { id: 5, accountId: 1, date: `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-09`, time: "16:20", result: "WIN", market: "Commodities", pair: "BRENT", size: 2.49, pnl: 298.92, notes: "", chartImage: null }
            ];
        }

        // Get default accounts data
        function getDefaultAccounts() {
            return [
                { 
                    id: 1, 
                    name: "Main Trading Account", 
                    currency: "USD", 
                    startingBalance: 54386.30,
                    deposits: 1989.25,
                    withdrawals: 0.00,
                    fees: 31.75
                },
                { 
                    id: 2, 
                    name: "Forex Account", 
                    currency: "USD", 
                    startingBalance: 10000.00,
                    deposits: 500.00,
                    withdrawals: 0.00,
                    fees: 15.50
                },
                { 
                    id: 3, 
                    name: "Crypto Account", 
                    currency: "USD", 
                    startingBalance: 5000.00,
                    deposits: 1000.00,
                    withdrawals: 200.00,
                    fees: 25.25
                }
            ];
        }

        // Initialize data
        let { trades, accounts } = loadData();

        // Market pairs data
        const marketPairs = {
            "Forex": ["EURUSD", "GBPUSD", "USDJPY", "AUDUSD", "USDCAD", "USDCHF", "NZDUSD", "EURGBP", "EURJPY", "GBPJPY", "AUDJPY", "EURCHF", "GBPCHF", "CADJPY", "CHFJPY", "AUDNZD", "AUDCAD", "AUDCHF", "CADCHF", "EURAUD", "EURCAD", "EURNZD", "GBPAUD", "GBPCAD", "GBPNZD", "NZDCAD", "NZDCHF", "NZDJPY"],
            "Crypto": ["BTCUSD", "ETHUSD", "XRPUSD", "LTCUSD", "BCHUSD", "ADAUSD", "DOTUSD", "LINKUSD", "XLMUSD", "DOGEUSD"],
            "Stocks": ["AAPL", "MSFT", "GOOGL", "AMZN", "TSLA", "META", "NVDA", "NFLX", "ETSY", "SPOT"],
            "Indices": ["US100", "US30", "SPX500", "UK100", "GER30", "JPN225", "AUS200", "FRA40"],
            "Commodities": ["XAUUSD", "XAGUSD", "BRENT", "WTI", "COPPER", "NATURALGAS"]
        };

        // DOM Elements
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-links li');
        const tradeTableBody = document.getElementById('trade-table-body');
        const addTradeBtn = document.getElementById('add-trade-btn');
        const tradeModal = document.getElementById('trade-modal');
        const closeModalBtn = document.querySelectorAll('.close-modal');
        const cancelTradeBtn = document.getElementById('cancel-trade');
        const tradeForm = document.getElementById('trade-form');
        const tradeMarketSelect = document.getElementById('trade-market');
        const tradePairSelect = document.getElementById('trade-pair');
        const chartUploadArea = document.getElementById('chart-upload-area');
        const chartImageInput = document.getElementById('chart-image');
        const chartPreview = document.getElementById('chart-preview');
        const modalTitle = document.getElementById('modal-title');
        const startingBalanceEl = document.getElementById('starting-balance');
        const exportDataBtn = document.getElementById('export-data');
        const importDataBtn = document.getElementById('import-data');
        const saveSettingsBtn = document.getElementById('save-settings');
        const resetSettingsBtn = document.getElementById('reset-settings');
        const accountSelect = document.getElementById('account-select');
        const journalAccountSelect = document.getElementById('journal-account-select');
        const analyticsAccountSelect = document.getElementById('analytics-account-select');
        const addAccountBtn = document.getElementById('add-account-btn');
        const deleteAccountBtn = document.getElementById('delete-account-btn');
        const accountModal = document.getElementById('account-modal');
        const accountForm = document.getElementById('account-form');
        const cancelAccountBtn = document.getElementById('cancel-account');
        const backupDataBtn = document.getElementById('backup-data');
        const restoreDataBtn = document.getElementById('restore-data');
        const clearDataBtn = document.getElementById('clear-data');
        const importModal = document.getElementById('import-modal');
        const cancelImportBtn = document.getElementById('cancel-import');
        const confirmImportBtn = document.getElementById('confirm-import');
        const importFileInput = document.getElementById('import-file');
        
        // Calendar elements
        const calendarGrid = document.getElementById('calendar-grid');
        const calendarMonthYear = document.getElementById('calendar-month-year');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const viewTradesBtn = document.getElementById('view-trades-btn');
        const monthlyProfitEl = document.getElementById('monthly-profit');
        const monthlyTradesEl = document.getElementById('monthly-trades');
        const monthlyWinRateEl = document.getElementById('monthly-win-rate');
        
        // Date filter elements
        const monthSelect = document.getElementById('month-select');
        const yearInput = document.getElementById('year-input');
        const journalMonthSelect = document.getElementById('journal-month');
        const journalYearInput = document.getElementById('journal-year');
        const analyticsMonthSelect = document.getElementById('analytics-month');
        const analyticsYearInput = document.getElementById('analytics-year');

        // Initialize the application
        function init() {
            // Set current date in all date filters
            setCurrentDateInFilters();
            
            renderTradeTable();
            setupEventListeners();
            initializeCharts();
            updateDashboard();
            updateAccountSelectors();
            renderCalendar();
            
            console.log('Trading Journal initialized with data persistence');
        }

        // Set current date in all date filters
        function setCurrentDateInFilters() {
            // Set dashboard date filters
            monthSelect.value = currentMonth;
            yearInput.value = currentYear;
            
            // Set journal date filters
            journalMonthSelect.value = currentMonth;
            journalYearInput.value = currentYear;
            
            // Set analytics date filters
            analyticsMonthSelect.value = currentMonth;
            analyticsYearInput.value = currentYear;
            
            // Set default date in trade form to today
            document.getElementById('trade-date').valueAsDate = new Date();
        }

        // Render the trade table
        function renderTradeTable() {
            tradeTableBody.innerHTML = '';
            
            const selectedAccountId = parseInt(journalAccountSelect.value);
            const accountTrades = trades.filter(t => t.accountId === selectedAccountId);
            
            if (accountTrades.length === 0) {
                tradeTableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">No trades found for this account. Add your first trade!</td></tr>';
                return;
            }
            
            // Sort trades by date (newest first)
            const sortedTrades = [...accountTrades].sort((a, b) => new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time));
            
            sortedTrades.forEach(trade => {
                const row = document.createElement('tr');
                
                let statusClass = '';
                if (trade.result === 'WIN') statusClass = 'status-win';
                else if (trade.result === 'LOSS') statusClass = 'status-loss';
                else if (trade.result === 'B/E') statusClass = 'status-breakeven';
                
                // Format date for display
                const dateObj = new Date(trade.date);
                const formattedDate = `${dateObj.getDate()}/${dateObj.getMonth()+1}/${dateObj.getFullYear()}`;
                
                row.innerHTML = `
                    <td>${trade.id}</td>
                    <td>${formattedDate} ${trade.time}</td>
                    <td class="${statusClass}">${trade.result}</td>
                    <td>${trade.market}</td>
                    <td>${trade.pair}</td>
                    <td>${trade.size}</td>
                    <td class="${trade.pnl >= 0 ? 'profit' : 'loss'}">${trade.pnl >= 0 ? '+' : ''}$${trade.pnl.toFixed(2)}</td>
                    <td>
                        <button class="btn edit-trade" data-id="${trade.id}" style="padding: 4px 8px; background: var(--primary); color: white;">Edit</button>
                        <button class="btn delete-trade" data-id="${trade.id}" style="padding: 4px 8px; background: var(--danger); color: white;">Delete</button>
                    </td>
                `;
                
                tradeTableBody.appendChild(row);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-trade').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const tradeId = parseInt(e.target.getAttribute('data-id'));
                    editTrade(tradeId);
                });
            });
            
            document.querySelectorAll('.delete-trade').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const tradeId = parseInt(e.target.getAttribute('data-id'));
                    deleteTrade(tradeId);
                });
            });
        }

        // Set up event listeners
        function setupEventListeners() {
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    const pageName = e.currentTarget.getAttribute('data-page');
                    showPage(pageName);
                    
                    // Update active nav link
                    navLinks.forEach(l => l.classList.remove('active'));
                    e.currentTarget.classList.add('active');
                });
            });
            
            // Modal controls
            addTradeBtn.addEventListener('click', () => {
                modalTitle.textContent = 'Add New Trade';
                tradeForm.reset();
                document.getElementById('trade-id').value = '';
                chartPreview.style.display = 'none';
                // Set default date to today
                document.getElementById('trade-date').valueAsDate = new Date();
                tradeModal.style.display = 'flex';
            });
            
            closeModalBtn.forEach(btn => {
                btn.addEventListener('click', () => {
                    tradeModal.style.display = 'none';
                    accountModal.style.display = 'none';
                    importModal.style.display = 'none';
                });
            });
            
            cancelTradeBtn.addEventListener('click', () => {
                tradeModal.style.display = 'none';
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === tradeModal) {
                    tradeModal.style.display = 'none';
                }
                if (e.target === accountModal) {
                    accountModal.style.display = 'none';
                }
                if (e.target === importModal) {
                    importModal.style.display = 'none';
                }
            });
            
            // Market selection change
            tradeMarketSelect.addEventListener('change', () => {
                updatePairOptions();
            });
            
            // Chart image upload
            chartUploadArea.addEventListener('click', () => {
                chartImageInput.click();
            });
            
            chartImageInput.addEventListener('change', (e) => {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        chartPreview.src = e.target.result;
                        chartPreview.style.display = 'block';
                    };
                    
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // Form submission
            tradeForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveTrade();
            });
            
            // Account selection change
            accountSelect.addEventListener('change', () => {
                updateDashboard();
                renderCalendar();
            });
            
            journalAccountSelect.addEventListener('change', () => {
                renderTradeTable();
            });
            
            analyticsAccountSelect.addEventListener('change', () => {
                // In a real app, you would update analytics charts here
            });
            
            // Account management
            addAccountBtn.addEventListener('click', () => {
                accountModal.style.display = 'flex';
            });
            
            deleteAccountBtn.addEventListener('click', () => {
                deleteAccount();
            });
            
            accountForm.addEventListener('submit', (e) => {
                e.preventDefault();
                addAccount();
            });
            
            cancelAccountBtn.addEventListener('click', () => {
                accountModal.style.display = 'none';
            });
            
            // Editable starting balance
            startingBalanceEl.addEventListener('click', () => {
                const selectedAccountId = parseInt(accountSelect.value);
                const account = accounts.find(a => a.id === selectedAccountId);
                const currentValue = account.startingBalance;
                const newValue = prompt('Enter new starting balance:', currentValue);
                if (newValue !== null && !isNaN(parseFloat(newValue))) {
                    account.startingBalance = parseFloat(newValue);
                    saveData(trades, accounts);
                    updateDashboard();
                }
            });
            
            // Export data
            exportDataBtn.addEventListener('click', () => {
                exportData();
            });
            
            // Import data
            importDataBtn.addEventListener('click', () => {
                importModal.style.display = 'flex';
            });
            
            cancelImportBtn.addEventListener('click', () => {
                importModal.style.display = 'none';
            });
            
            confirmImportBtn.addEventListener('click', () => {
                importData();
            });
            
            // Data management
            backupDataBtn.addEventListener('click', () => {
                backupData();
            });
            
            restoreDataBtn.addEventListener('click', () => {
                importModal.style.display = 'flex';
            });
            
            clearDataBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear ALL data? This cannot be undone!')) {
                    clearAllData();
                }
            });
            
            // Settings
            saveSettingsBtn.addEventListener('click', () => {
                saveSettings();
            });
            
            resetSettingsBtn.addEventListener('click', () => {
                resetSettings();
            });
            
            // Calendar controls
            prevMonthBtn.addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                updateDateFilters();
                renderCalendar();
            });
            
            nextMonthBtn.addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                updateDateFilters();
                renderCalendar();
            });
            
            // Date filter changes
            monthSelect.addEventListener('change', () => {
                currentMonth = parseInt(monthSelect.value);
                renderCalendar();
            });
            
            yearInput.addEventListener('change', () => {
                currentYear = parseInt(yearInput.value);
                renderCalendar();
            });
            
            // View trades button
            viewTradesBtn.addEventListener('click', () => {
                showPage('journal');
                navLinks.forEach(l => l.classList.remove('active'));
                document.querySelector('[data-page="journal"]').classList.add('active');
            });
        }

        // Update date filters when calendar navigation changes
        function updateDateFilters() {
            monthSelect.value = currentMonth;
            yearInput.value = currentYear;
        }

        // Show specific page
        function showPage(pageName) {
            pages.forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(`${pageName}-page`).classList.add('active');
        }

        // Update pair options based on selected market
        function updatePairOptions() {
            const selectedMarket = tradeMarketSelect.value;
            tradePairSelect.innerHTML = '<option value="">Select Pair</option>';
            
            if (selectedMarket && marketPairs[selectedMarket]) {
                marketPairs[selectedMarket].forEach(pair => {
                    const option = document.createElement('option');
                    option.value = pair;
                    option.textContent = pair;
                    tradePairSelect.appendChild(option);
                });
            }
        }

        // Save trade (add or update)
        function saveTrade() {
            const tradeId = document.getElementById('trade-id').value;
            const selectedAccountId = parseInt(journalAccountSelect.value);
            
            const tradeData = {
                accountId: selectedAccountId,
                date: document.getElementById('trade-date').value,
                time: document.getElementById('trade-time').value,
                market: document.getElementById('trade-market').value,
                pair: document.getElementById('trade-pair').value,
                direction: document.getElementById('trade-direction').value,
                size: parseFloat(document.getElementById('trade-size').value),
                result: document.getElementById('trade-result').value,
                pnl: parseFloat(document.getElementById('trade-pnl').value),
                notes: document.getElementById('trade-notes').value,
                chartImage: chartPreview.style.display !== 'none' ? chartPreview.src : null
            };
            
            if (tradeId) {
                // Update existing trade
                const index = trades.findIndex(t => t.id === parseInt(tradeId));
                if (index !== -1) {
                    trades[index] = { ...trades[index], ...tradeData };
                }
            } else {
                // Add new trade
                const newId = trades.length > 0 ? Math.max(...trades.map(t => t.id)) + 1 : 1;
                trades.push({ id: newId, ...tradeData });
            }
            
            // Save to localStorage
            saveData(trades, accounts);
            
            tradeModal.style.display = 'none';
            renderTradeTable();
            updateDashboard();
            renderCalendar();
            
            alert('Trade saved successfully!');
        }

        // Edit trade
        function editTrade(tradeId) {
            const trade = trades.find(t => t.id === tradeId);
            if (!trade) return;
            
            modalTitle.textContent = 'Edit Trade';
            document.getElementById('trade-id').value = trade.id;
            document.getElementById('trade-date').value = trade.date;
            document.getElementById('trade-time').value = trade.time;
            document.getElementById('trade-market').value = trade.market;
            updatePairOptions();
            document.getElementById('trade-pair').value = trade.pair;
            document.getElementById('trade-direction').value = trade.direction || 'Long';
            document.getElementById('trade-size').value = trade.size;
            document.getElementById('trade-result').value = trade.result;
            document.getElementById('trade-pnl').value = trade.pnl;
            document.getElementById('trade-notes').value = trade.notes || '';
            
            if (trade.chartImage) {
                chartPreview.src = trade.chartImage;
                chartPreview.style.display = 'block';
            } else {
                chartPreview.style.display = 'none';
            }
            
            tradeModal.style.display = 'flex';
        }

        // Delete trade
        function deleteTrade(tradeId) {
            if (confirm('Are you sure you want to delete this trade?')) {
                trades = trades.filter(t => t.id !== tradeId);
                saveData(trades, accounts);
                renderTradeTable();
                updateDashboard();
                renderCalendar();
                alert('Trade deleted successfully!');
            }
        }

        // Update dashboard statistics
        function updateDashboard() {
            const selectedAccountId = parseInt(accountSelect.value);
            const account = accounts.find(a => a.id === selectedAccountId);
            
            if (!account) return;
            
            const accountTrades = trades.filter(t => t.accountId === selectedAccountId);
            const totalTrades = accountTrades.length;
            const winningTrades = accountTrades.filter(t => t.result === 'WIN').length;
            const losingTrades = accountTrades.filter(t => t.result === 'LOSS').length;
            const breakEvenTrades = accountTrades.filter(t => t.result === 'B/E').length;
            const totalPnl = accountTrades.reduce((sum, trade) => sum + trade.pnl, 0);
            const winRate = totalTrades > 0 ? (winningTrades / totalTrades * 100).toFixed(2) : 0;
            
            // Update DOM elements
            startingBalanceEl.textContent = `$${account.startingBalance.toFixed(2)}`;
            document.getElementById('total-trades').textContent = totalTrades;
            document.getElementById('win-rate').textContent = `${winRate}%`;
            document.getElementById('total-pnl').textContent = totalPnl >= 0 ? `+$${totalPnl.toFixed(2)}` : `-$${Math.abs(totalPnl).toFixed(2)}`;
            document.getElementById('actual-balance').textContent = `$${(account.startingBalance + totalPnl + account.deposits - account.withdrawals - account.fees).toFixed(2)}`;
            
            // Update Profit & Loss section with account-specific data
            document.getElementById('total-deposits').textContent = `$${account.deposits.toFixed(2)}`;
            document.getElementById('total-withdrawals').textContent = `$${account.withdrawals.toFixed(2)}`;
            document.getElementById('total-fees').textContent = `-$${account.fees.toFixed(2)}`;
            
            // Calculate additional stats
            const avgWin = winningTrades > 0 ? 
                accountTrades.filter(t => t.result === 'WIN').reduce((sum, trade) => sum + trade.pnl, 0) / winningTrades : 0;
            const avgLoss = losingTrades > 0 ? 
                accountTrades.filter(t => t.result === 'LOSS').reduce((sum, trade) => sum + trade.pnl, 0) / losingTrades : 0;
            
            document.getElementById('avg-win').textContent = `$${avgWin.toFixed(2)}`;
            document.getElementById('avg-loss').textContent = `-$${Math.abs(avgLoss).toFixed(2)}`;
            
            // Update charts if they exist
            if (window.growthChart) {
                updateGrowthChart();
            }
        }

        // Update account selectors
        function updateAccountSelectors() {
            // Clear existing options
            accountSelect.innerHTML = '';
            journalAccountSelect.innerHTML = '';
            analyticsAccountSelect.innerHTML = '';
            
            // Add accounts to selectors
            accounts.forEach(account => {
                const option1 = document.createElement('option');
                option1.value = account.id;
                option1.textContent = account.name;
                accountSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = account.id;
                option2.textContent = account.name;
                journalAccountSelect.appendChild(option2);
                
                const option3 = document.createElement('option');
                option3.value = account.id;
                option3.textContent = account.name;
                analyticsAccountSelect.appendChild(option3);
            });
        }

        // Add new account
        function addAccount() {
            const accountName = document.getElementById('new-account-name').value;
            const accountCurrency = document.getElementById('new-account-currency').value;
            const startingBalance = parseFloat(document.getElementById('new-account-balance').value);
            
            const newId = accounts.length > 0 ? Math.max(...accounts.map(a => a.id)) + 1 : 1;
            accounts.push({
                id: newId,
                name: accountName,
                currency: accountCurrency,
                startingBalance: startingBalance,
                deposits: 0.00,
                withdrawals: 0.00,
                fees: 0.00
            });
            
            // Save to localStorage
            saveData(trades, accounts);
            
            accountModal.style.display = 'none';
            updateAccountSelectors();
            accountForm.reset();
            
            alert('Account added successfully!');
        }

        // Delete account
        function deleteAccount() {
            const selectedAccountId = parseInt(accountSelect.value);
            
            if (accounts.length <= 1) {
                alert('You must have at least one account.');
                return;
            }
            
            if (confirm('Are you sure you want to delete this account? All trades associated with this account will also be deleted.')) {
                // Remove account
                accounts = accounts.filter(a => a.id !== selectedAccountId);
                
                // Remove trades for this account
                trades = trades.filter(t => t.accountId !== selectedAccountId);
                
                // Save to localStorage
                saveData(trades, accounts);
                
                updateAccountSelectors();
                renderTradeTable();
                updateDashboard();
                renderCalendar();
                
                alert('Account deleted successfully!');
            }
        }

        // Export data
        function exportData() {
            const selectedAccountId = parseInt(journalAccountSelect.value);
            const accountTrades = trades.filter(t => t.accountId === selectedAccountId);
            const account = accounts.find(a => a.id === selectedAccountId);
            
            const exportData = {
                trades: accountTrades,
                account: account,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `trading-journal-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('Data exported successfully!');
        }

        // Import data
        function importData() {
            const file = importFileInput.files[0];
            if (!file) {
                alert('Please select a backup file to import.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!importedData.trades || !importedData.account) {
                        throw new Error('Invalid backup file format');
                    }
                    
                    if (confirm('This will replace all current data. Are you sure?')) {
                        // Replace current data with imported data
                        const accountId = importedData.account.id;
                        
                        // Remove existing trades for this account
                        trades = trades.filter(t => t.accountId !== accountId);
                        
                        // Add imported trades
                        trades.push(...importedData.trades);
                        
                        // Update account data
                        const accountIndex = accounts.findIndex(a => a.id === accountId);
                        if (accountIndex !== -1) {
                            accounts[accountIndex] = importedData.account;
                        }
                        
                        // Save to localStorage
                        saveData(trades, accounts);
                        
                        // Refresh UI
                        renderTradeTable();
                        updateDashboard();
                        renderCalendar();
                        updateAccountSelectors();
                        
                        importModal.style.display = 'none';
                        alert('Data imported successfully!');
                    }
                } catch (error) {
                    alert('Error importing data: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Backup all data
        function backupData() {
            const allData = {
                trades: trades,
                accounts: accounts,
                backupDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `trading-journal-full-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('Full backup created successfully!');
        }

        // Clear all data
        function clearAllData() {
            // Reset to default data
            trades = getDefaultTrades();
            accounts = getDefaultAccounts();
            
            // Save to localStorage
            saveData(trades, accounts);
            
            // Refresh UI
            renderTradeTable();
            updateDashboard();
            renderCalendar();
            updateAccountSelectors();
            
            alert('All data cleared and reset to defaults!');
        }

        // Save settings
        function saveSettings() {
            const settings = {
                accountName: document.getElementById('account-name').value,
                accountCurrency: document.getElementById('account-currency').value,
                riskPerTrade: document.getElementById('risk-per-trade').value,
                defaultLotSize: document.getElementById('default-lot-size').value
            };
            
            localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(settings));
            alert('Settings saved successfully!');
        }

        // Reset settings
        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings to default?')) {
                localStorage.removeItem(STORAGE_KEYS.SETTINGS);
                document.getElementById('account-name').value = 'Main Trading Account';
                document.getElementById('account-currency').value = 'USD';
                document.getElementById('risk-per-trade').value = '1';
                document.getElementById('default-lot-size').value = '0.1';
                alert('Settings reset to default!');
            }
        }

        // Load settings
        function loadSettings() {
            const savedSettings = localStorage.getItem(STORAGE_KEYS.SETTINGS);
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                document.getElementById('account-name').value = settings.accountName || 'Main Trading Account';
                document.getElementById('account-currency').value = settings.accountCurrency || 'USD';
                document.getElementById('risk-per-trade').value = settings.riskPerTrade || '1';
                document.getElementById('default-lot-size').value = settings.defaultLotSize || '0.1';
            }
        }

        // Initialize charts
        function initializeCharts() {
            // Growth Chart
            const growthCtx = document.getElementById('growthChart').getContext('2d');
            window.growthChart = new Chart(growthCtx, {
                type: 'line',
                data: {
                    labels: ['Mar 12', 'Mar 13', 'Mar 14', 'Mar 15', 'Mar 16', 'Mar 17', 'Mar 18'],
                    datasets: [{
                        label: 'Account Balance',
                        data: [54386, 54542, 54750, 54520, 54300, 54200, 54175],
                        borderColor: '#1a237e',
                        backgroundColor: 'rgba(26, 35, 126, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Distribution Chart
            const distributionCtx = document.getElementById('distributionChart').getContext('2d');
            const distributionChart = new Chart(distributionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Wins', 'Losses', 'Break Even'],
                    datasets: [{
                        data: [65, 30, 5],
                        backgroundColor: [
                            '#4caf50',
                            '#f44336',
                            '#ff9800'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Analytics Charts
            if (document.getElementById('marketChart')) {
                const marketCtx = document.getElementById('marketChart').getContext('2d');
                const marketChart = new Chart(marketCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Forex', 'Crypto', 'Stocks', 'Indices', 'Commodities'],
                        datasets: [{
                            label: 'Total P&L',
                            data: [320, -150, 180, 240, -80],
                            backgroundColor: [
                                'rgba(26, 35, 126, 0.7)',
                                'rgba(244, 67, 54, 0.7)',
                                'rgba(76, 175, 80, 0.7)',
                                'rgba(255, 152, 0, 0.7)',
                                'rgba(156, 39, 176, 0.7)'
                            ],
                            borderColor: [
                                '#1a237e',
                                '#f44336',
                                '#4caf50',
                                '#ff9800',
                                '#9c27b0'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
                
                const winRateCtx = document.getElementById('winRateChart').getContext('2d');
                const winRateChart = new Chart(winRateCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Forex', 'Crypto', 'Stocks', 'Indices', 'Commodities'],
                        datasets: [{
                            data: [70, 40, 60, 75, 55],
                            backgroundColor: [
                                'rgba(26, 35, 126, 0.7)',
                                'rgba(244, 67, 54, 0.7)',
                                'rgba(76, 175, 80, 0.7)',
                                'rgba(255, 152, 0, 0.7)',
                                'rgba(156, 39, 176, 0.7)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        // Update growth chart with real data
        function updateGrowthChart() {
            // In a real app, you would calculate the balance for each day
            // For this demo, we'll just use sample data
            const selectedAccountId = parseInt(accountSelect.value);
            const account = accounts.find(a => a.id === selectedAccountId);
            const accountTrades = trades.filter(t => t.accountId === selectedAccountId);
            const totalPnl = accountTrades.reduce((sum, trade) => sum + trade.pnl, 0);
            
            window.growthChart.data.datasets[0].data = [
                account.startingBalance,
                account.startingBalance + totalPnl * 0.2,
                account.startingBalance + totalPnl * 0.4,
                account.startingBalance + totalPnl * 0.6,
                account.startingBalance + totalPnl * 0.8,
                account.startingBalance + totalPnl
            ];
            window.growthChart.update();
        }

        // Render the calendar
        function renderCalendar() {
            const selectedAccountId = parseInt(accountSelect.value);
            const accountTrades = trades.filter(t => t.accountId === selectedAccountId);
            
            // Update month/year display
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            calendarMonthYear.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            // Clear calendar grid
            calendarGrid.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Add days of the month
            let totalMonthlyProfit = 0;
            let totalMonthlyTrades = 0;
            let monthlyWinningTrades = 0;
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                
                // Format date for comparison
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                // Check if this is today
                const today = new Date();
                if (today.getFullYear() === currentYear && 
                    today.getMonth() === currentMonth && 
                    today.getDate() === day) {
                    dayCell.classList.add('today');
                }
                
                // Find trades for this day
                const dayTrades = accountTrades.filter(t => t.date === dateStr);
                const dayProfit = dayTrades.reduce((sum, trade) => sum + trade.pnl, 0);
                const dayTradeCount = dayTrades.length;
                
                // Update monthly totals
                totalMonthlyProfit += dayProfit;
                totalMonthlyTrades += dayTradeCount;
                monthlyWinningTrades += dayTrades.filter(t => t.result === 'WIN').length;
                
                // Add day number
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayCell.appendChild(dayNumber);
                
                // Add P&L if there are trades
                if (dayTradeCount > 0) {
                    const dayPnl = document.createElement('div');
                    dayPnl.className = `day-pnl ${dayProfit >= 0 ? 'profit' : 'loss'}`;
                    dayPnl.textContent = `${dayProfit >= 0 ? '+' : ''}$${dayProfit.toFixed(2)}`;
                    dayCell.appendChild(dayPnl);
                    
                    const dayTradesCount = document.createElement('div');
                    dayTradesCount.className = 'day-trades';
                    dayTradesCount.textContent = `${dayTradeCount} trade${dayTradeCount > 1 ? 's' : ''}`;
                    dayCell.appendChild(dayTradesCount);
                }
                
                // Add click event to view trades for this day
                if (dayTradeCount > 0) {
                    dayCell.style.cursor = 'pointer';
                    dayCell.addEventListener('click', () => {
                        showPage('journal');
                        navLinks.forEach(l => l.classList.remove('active'));
                        document.querySelector('[data-page="journal"]').classList.add('active');
                        
                        // Filter trade table to show only this day's trades
                        const journalMonthSelect = document.getElementById('journal-month');
                        const journalYearInput = document.getElementById('journal-year');
                        
                        journalMonthSelect.value = currentMonth;
                        journalYearInput.value = currentYear;
                        
                        // In a real app, you would filter the trade table to show only this day's trades
                        alert(`Showing ${dayTradeCount} trades for ${dateStr}`);
                    });
                }
                
                calendarGrid.appendChild(dayCell);
            }
            
            // Update monthly summary
            monthlyProfitEl.textContent = `$${totalMonthlyProfit.toFixed(2)}`;
            monthlyTradesEl.textContent = totalMonthlyTrades;
            const monthlyWinRate = totalMonthlyTrades > 0 ? (monthlyWinningTrades / totalMonthlyTrades * 100).toFixed(0) : 0;
            monthlyWinRateEl.textContent = `${monthlyWinRate}%`;
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            init();
            loadSettings();
        });
    </script>
</body>
</html>